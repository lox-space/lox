use nom::error::ErrorKind;

const RECORD_SIZE: u32 = 1024;

#[derive(Debug, PartialEq)]
pub struct FileRecord {
    pub locidw: String,
    pub nd: u32,
    pub ni: u32,
    pub locifn: String,
    pub fward: u32,
    pub bward: u32,
    pub free: u32,
    pub locfmt: String,
    pub prenul: Vec<u8>,
    pub ftpstr: Vec<u8>,
    pub pstnul: Vec<u8>,
}

#[derive(Debug, PartialEq)]
pub struct SPK {
    pub file_record: FileRecord,
    pub comment: String,
}

pub fn parse_file_record(input: &[u8]) -> nom::IResult<&[u8], FileRecord> {
    // 1. LOCIDW (8 charactersu8, 8 bytes): An identification word (`DAF/xxxx').
    // The 'xxxx' substring is a string of four characters or less indicating the
    // type of data stored in the DAF file. This is used by the SPICELIB
    // subroutines to verify that a particular file is in fact a DAF and not
    // merely a direct access file with the same record length. When
    // a DAF is openedu8, an error signals if this keyword is not present. [Address
    // 0]
    let (input, locidw) = nom::bytes::complete::take(8u32)(input)?;

    // 2. ND ( 1 integeru8, 4 bytes): The number of double precision components in
    // each array summary. [Address 8]
    let (input, nd) = nom::number::complete::le_u32(input)?;

    // 3. NI ( 1 integeru8, 4 bytes): The number of integer components in each array
    // summary. [Address 12]
    let (input, ni) = nom::number::complete::le_u32(input)?;

    // 4. LOCIFN (60 charactersu8, 60 bytes): The internal name or description of
    // the array file. [Address 16]
    let (input, locifn) = nom::bytes::complete::take(60u32)(input)?;

    // 5. FWARD ( 1 integeru8, 4 bytes): The record number of the initial summary
    // record in the file. [Address 76]
    let (input, fward) = nom::number::complete::le_u32(input)?;

    // 6. BWARD ( 1 integeru8, 4 bytes): The record number of the final summary
    // record in the file. [Address 80]
    let (input, bward) = nom::number::complete::le_u32(input)?;

    // 7. FREE ( 1 integeru8, 4 bytes): The first free address in the file. This is
    // the address at which the first element of the next array to be added to
    // the file will be stored. [Address 84]
    let (input, free) = nom::number::complete::le_u32(input)?;

    // 8. LOCFMT ( 8 charactersu8, 8 bytes): The character string that indicates the
    // numeric binary format of the DAF. The string has value either "LTL-IEEE"
    // or "BIG-IEEE." [Address 88]
    let (input, locfmt) = nom::bytes::complete::take(8u32)(input)?;

    // 9. PRENUL ( 603 charactersu8, 603 bytes): A block of nulls to pad between the
    // last character of LOCFMT and the first character of FTPSTR to keep FTPSTR
    // at character 700 (address 699) in a 1024 byte record. [Address 96]
    let (input, prenul) = nom::bytes::complete::take(603u32)(input)?;

    // 10. FTPSTR ( 28 charactersu8, 28 bytes): The FTP validation string.
    // This string is assembled using components returned from the SPICELIB private
    // routine ZZFTPSTR. [Address 699]
    let (input, ftpstr) = nom::bytes::complete::take(28u32)(input)?;

    // 11. PSTNUL ( 297 charactersu8, 297 bytes): A block of nulls to pad from the
    // last character of FTPSTR to the end of the file record. Note: this value
    // enforces the length of the file record as 1024 bytes. [Address 727]
    let (input, pstnul) = nom::bytes::complete::take(297u32)(input)?;

    // We know the loc strings are ASCII in the spec, so parsing them as utf-8
    // should be safe.
    Ok((
        input,
        FileRecord {
            locidw: String::from_utf8_lossy(locidw).trim().to_string(),
            nd,
            ni,
            locifn: String::from_utf8_lossy(locifn).trim().to_string(),
            fward,
            bward,
            free,
            locfmt: String::from_utf8_lossy(locfmt).trim().to_string(),
            prenul: prenul.to_owned(),
            ftpstr: ftpstr.to_owned(),
            pstnul: pstnul.to_owned(),
        },
    ))
}

pub fn parse_comment_area(input: &[u8], comment_areas_count: u32) -> nom::IResult<&[u8], String> {
    // This function is definetely not optimal as there are several allocations at different points but this is not a hot data path.
    let mut comment_area = String::new();

    let mut input_cursor = input;
    for _ in 0..comment_areas_count {
        let (updated_input_cursor, comment_areas) =
            nom::bytes::complete::take(RECORD_SIZE)(input_cursor)?;

        input_cursor = updated_input_cursor;

        let (_, comment_record_content) = nom::bytes::complete::take(1000u32)(comment_areas)?;

        let comment_record_content =
            match nom::bytes::complete::take_until("\x04")(comment_record_content) {
                Ok((_, content_to_end_of_transmission_char)) => content_to_end_of_transmission_char,
                Err(error) => match error {
                    // This is one ugly error type. What we're saying here is, if we can't
                    // find the end of transmission character, just return the whole thing.
                    nom::Err::Error(nom::error::Error {
                        input: _,
                        code: ErrorKind::TakeUntil,
                    }) => comment_record_content,
                    _ => Err(error)?,
                },
            };

        let comment_record_content =
            String::from_utf8_lossy(comment_record_content).replace("\0", "\n");

        comment_area.push_str(&comment_record_content)
    }

    let comment_area = comment_area.trim().to_string();

    Ok((input_cursor, comment_area))
}

pub fn parse_daf_spk(input: &[u8]) -> nom::IResult<&[u8], SPK> {
    // From https://naif.jpl.nasa.gov/pub/naif/toolkit_docs/C/req/daf.html

    let (input, file_record) = parse_file_record(input)?;

    let (input, comment) = parse_comment_area(input, file_record.fward - 2)?;

    Ok((
        input,
        SPK {
            file_record,
            comment,
        },
    ))
}

#[test]
fn test_parse_comment_area() {
    const COMMENT_AREA_SEGMENT: [u8; 2048] = [
        0x00u8, 0x00u8, 0x53u8, 0x65u8, 0x70u8, 0x74u8, 0x65u8, 0x6du8, 0x62u8, 0x65u8, 0x72u8,
        0x20u8, 0x30u8, 0x33u8, 0x2cu8, 0x20u8, 0x32u8, 0x30u8, 0x31u8, 0x33u8, 0x00u8, 0x43u8,
        0x2eu8, 0x20u8, 0x41u8, 0x63u8, 0x74u8, 0x6fu8, 0x6eu8, 0x00u8, 0x00u8, 0x4au8, 0x50u8,
        0x4cu8, 0x27u8, 0x73u8, 0x20u8, 0x53u8, 0x6fu8, 0x6cu8, 0x61u8, 0x72u8, 0x20u8, 0x53u8,
        0x79u8, 0x73u8, 0x74u8, 0x65u8, 0x6du8, 0x20u8, 0x44u8, 0x79u8, 0x6eu8, 0x61u8, 0x6du8,
        0x69u8, 0x63u8, 0x73u8, 0x20u8, 0x47u8, 0x72u8, 0x6fu8, 0x75u8, 0x70u8, 0x20u8, 0x68u8,
        0x61u8, 0x73u8, 0x20u8, 0x72u8, 0x65u8, 0x6cu8, 0x65u8, 0x61u8, 0x73u8, 0x65u8, 0x64u8,
        0x20u8, 0x74u8, 0x77u8, 0x6fu8, 0x20u8, 0x6eu8, 0x65u8, 0x77u8, 0x20u8, 0x70u8, 0x6cu8,
        0x61u8, 0x6eu8, 0x65u8, 0x74u8, 0x61u8, 0x72u8, 0x79u8, 0x2fu8, 0x6cu8, 0x75u8, 0x6eu8,
        0x61u8, 0x72u8, 0x20u8, 0x65u8, 0x70u8, 0x68u8, 0x65u8, 0x6du8, 0x65u8, 0x72u8, 0x69u8,
        0x64u8, 0x65u8, 0x73u8, 0x2cu8, 0x00u8, 0x6eu8, 0x61u8, 0x6du8, 0x65u8, 0x64u8, 0x20u8,
        0x44u8, 0x45u8, 0x34u8, 0x33u8, 0x30u8, 0x20u8, 0x61u8, 0x6eu8, 0x64u8, 0x20u8, 0x44u8,
        0x45u8, 0x34u8, 0x33u8, 0x31u8, 0x2eu8, 0x00u8, 0x00u8, 0x44u8, 0x45u8, 0x34u8, 0x33u8,
        0x30u8, 0x20u8, 0x69u8, 0x73u8, 0x20u8, 0x6eu8, 0x6fu8, 0x77u8, 0x20u8, 0x63u8, 0x6fu8,
        0x6eu8, 0x73u8, 0x69u8, 0x64u8, 0x65u8, 0x72u8, 0x65u8, 0x64u8, 0x20u8, 0x74u8, 0x68u8,
        0x65u8, 0x20u8, 0x6fu8, 0x66u8, 0x66u8, 0x69u8, 0x63u8, 0x69u8, 0x61u8, 0x6cu8, 0x20u8,
        0x65u8, 0x78u8, 0x70u8, 0x6fu8, 0x72u8, 0x74u8, 0x20u8, 0x6cu8, 0x75u8, 0x6eu8, 0x61u8,
        0x72u8, 0x2fu8, 0x70u8, 0x6cu8, 0x61u8, 0x6eu8, 0x65u8, 0x74u8, 0x61u8, 0x72u8, 0x79u8,
        0x20u8, 0x65u8, 0x70u8, 0x68u8, 0x65u8, 0x6du8, 0x65u8, 0x72u8, 0x69u8, 0x73u8, 0x2cu8,
        0x20u8, 0x73u8, 0x75u8, 0x69u8, 0x74u8, 0x61u8, 0x62u8, 0x6cu8, 0x65u8, 0x20u8, 0x66u8,
        0x6fu8, 0x72u8, 0x00u8, 0x61u8, 0x6cu8, 0x6cu8, 0x20u8, 0x75u8, 0x73u8, 0x65u8, 0x72u8,
        0x73u8, 0x2fu8, 0x75u8, 0x73u8, 0x65u8, 0x73u8, 0x2eu8, 0x20u8, 0x49u8, 0x74u8, 0x27u8,
        0x73u8, 0x20u8, 0x61u8, 0x70u8, 0x70u8, 0x72u8, 0x6fu8, 0x78u8, 0x69u8, 0x6du8, 0x61u8,
        0x74u8, 0x65u8, 0x20u8, 0x74u8, 0x69u8, 0x6du8, 0x65u8, 0x20u8, 0x73u8, 0x70u8, 0x61u8,
        0x6eu8, 0x20u8, 0x69u8, 0x73u8, 0x20u8, 0x31u8, 0x35u8, 0x35u8, 0x30u8, 0x20u8, 0x4au8,
        0x41u8, 0x4eu8, 0x20u8, 0x30u8, 0x31u8, 0x20u8, 0x74u8, 0x6fu8, 0x20u8, 0x32u8, 0x36u8,
        0x35u8, 0x30u8, 0x20u8, 0x4au8, 0x41u8, 0x4eu8, 0x20u8, 0x32u8, 0x32u8, 0x2eu8, 0x00u8,
        0x00u8, 0x49u8, 0x66u8, 0x20u8, 0x61u8, 0x20u8, 0x6cu8, 0x6fu8, 0x6eu8, 0x67u8, 0x65u8,
        0x72u8, 0x20u8, 0x74u8, 0x69u8, 0x6du8, 0x65u8, 0x20u8, 0x73u8, 0x70u8, 0x61u8, 0x6eu8,
        0x20u8, 0x69u8, 0x73u8, 0x20u8, 0x6eu8, 0x65u8, 0x65u8, 0x64u8, 0x65u8, 0x64u8, 0x2cu8,
        0x20u8, 0x44u8, 0x45u8, 0x34u8, 0x33u8, 0x31u8, 0x20u8, 0x6du8, 0x61u8, 0x79u8, 0x20u8,
        0x62u8, 0x65u8, 0x20u8, 0x75u8, 0x73u8, 0x65u8, 0x64u8, 0x2cu8, 0x20u8, 0x65u8, 0x78u8,
        0x63u8, 0x65u8, 0x70u8, 0x74u8, 0x20u8, 0x74u8, 0x68u8, 0x61u8, 0x74u8, 0x20u8, 0x74u8,
        0x68u8, 0x65u8, 0x20u8, 0x6cu8, 0x75u8, 0x6eu8, 0x61u8, 0x72u8, 0x20u8, 0x65u8, 0x70u8,
        0x68u8, 0x65u8, 0x6du8, 0x65u8, 0x72u8, 0x69u8, 0x73u8, 0x00u8, 0x70u8, 0x6fu8, 0x72u8,
        0x74u8, 0x69u8, 0x6fu8, 0x6eu8, 0x20u8, 0x69u8, 0x73u8, 0x20u8, 0x6fu8, 0x66u8, 0x20u8,
        0x72u8, 0x65u8, 0x6cu8, 0x61u8, 0x74u8, 0x69u8, 0x76u8, 0x65u8, 0x6cu8, 0x79u8, 0x20u8,
        0x70u8, 0x6fu8, 0x6fu8, 0x72u8, 0x20u8, 0x61u8, 0x63u8, 0x63u8, 0x75u8, 0x72u8, 0x61u8,
        0x63u8, 0x79u8, 0x20u8, 0x6fu8, 0x75u8, 0x74u8, 0x73u8, 0x69u8, 0x64u8, 0x65u8, 0x20u8,
        0x6fu8, 0x66u8, 0x20u8, 0x74u8, 0x68u8, 0x65u8, 0x20u8, 0x74u8, 0x69u8, 0x6du8, 0x65u8,
        0x20u8, 0x73u8, 0x70u8, 0x61u8, 0x6eu8, 0x20u8, 0x63u8, 0x6fu8, 0x76u8, 0x65u8, 0x72u8,
        0x65u8, 0x64u8, 0x20u8, 0x62u8, 0x79u8, 0x20u8, 0x44u8, 0x45u8, 0x34u8, 0x33u8, 0x30u8,
        0x2eu8, 0x00u8, 0x54u8, 0x68u8, 0x65u8, 0x20u8, 0x74u8, 0x69u8, 0x6du8, 0x65u8, 0x20u8,
        0x73u8, 0x70u8, 0x61u8, 0x6eu8, 0x20u8, 0x63u8, 0x6fu8, 0x76u8, 0x65u8, 0x72u8, 0x65u8,
        0x64u8, 0x20u8, 0x62u8, 0x79u8, 0x20u8, 0x44u8, 0x45u8, 0x34u8, 0x33u8, 0x31u8, 0x20u8,
        0x69u8, 0x73u8, 0x20u8, 0x61u8, 0x70u8, 0x70u8, 0x72u8, 0x6fu8, 0x78u8, 0x69u8, 0x6du8,
        0x61u8, 0x74u8, 0x65u8, 0x6cu8, 0x79u8, 0x20u8, 0x31u8, 0x33u8, 0x32u8, 0x30u8, 0x32u8,
        0x20u8, 0x42u8, 0x2eu8, 0x43u8, 0x2eu8, 0x20u8, 0x74u8, 0x6fu8, 0x20u8, 0x31u8, 0x37u8,
        0x31u8, 0x39u8, 0x31u8, 0x20u8, 0x41u8, 0x2eu8, 0x44u8, 0x2eu8, 0x20u8, 0x42u8, 0x65u8,
        0x63u8, 0x61u8, 0x75u8, 0x73u8, 0x65u8, 0x20u8, 0x64u8, 0x65u8, 0x34u8, 0x33u8, 0x31u8,
        0x00u8, 0x69u8, 0x73u8, 0x20u8, 0x73u8, 0x6fu8, 0x20u8, 0x6cu8, 0x6fu8, 0x6eu8, 0x67u8,
        0x2cu8, 0x20u8, 0x6cu8, 0x65u8, 0x61u8, 0x64u8, 0x69u8, 0x6eu8, 0x67u8, 0x20u8, 0x74u8,
        0x6fu8, 0x20u8, 0x61u8, 0x20u8, 0x68u8, 0x75u8, 0x67u8, 0x65u8, 0x20u8, 0x66u8, 0x69u8,
        0x6cu8, 0x65u8, 0x2cu8, 0x20u8, 0x69u8, 0x74u8, 0x20u8, 0x68u8, 0x61u8, 0x73u8, 0x20u8,
        0x62u8, 0x65u8, 0x65u8, 0x6eu8, 0x20u8, 0x73u8, 0x70u8, 0x6cu8, 0x69u8, 0x74u8, 0x20u8,
        0x69u8, 0x6eu8, 0x74u8, 0x6fu8, 0x20u8, 0x74u8, 0x77u8, 0x6fu8, 0x20u8, 0x70u8, 0x61u8,
        0x72u8, 0x74u8, 0x73u8, 0x20u8, 0x68u8, 0x61u8, 0x76u8, 0x69u8, 0x6eu8, 0x67u8, 0x20u8,
        0x74u8, 0x68u8, 0x65u8, 0x00u8, 0x61u8, 0x70u8, 0x70u8, 0x72u8, 0x6fu8, 0x78u8, 0x69u8,
        0x6du8, 0x61u8, 0x67u8, 0x74u8, 0x65u8, 0x20u8, 0x74u8, 0x69u8, 0x6du8, 0x65u8, 0x20u8,
        0x73u8, 0x70u8, 0x61u8, 0x6eu8, 0x73u8, 0x20u8, 0x6fu8, 0x66u8, 0x3au8, 0x00u8, 0x00u8,
        0x20u8, 0x20u8, 0x20u8, 0x31u8, 0x33u8, 0x32u8, 0x30u8, 0x32u8, 0x20u8, 0x42u8, 0x2eu8,
        0x43u8, 0x2eu8, 0x20u8, 0x74u8, 0x6fu8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x30u8,
        0x00u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x30u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x74u8, 0x6fu8, 0x20u8, 0x31u8, 0x37u8, 0x31u8, 0x39u8,
        0x31u8, 0x20u8, 0x41u8, 0x2eu8, 0x44u8, 0x2eu8, 0x00u8, 0x00u8, 0x4du8, 0x6fu8, 0x72u8,
        0x65u8, 0x20u8, 0x64u8, 0x65u8, 0x74u8, 0x61u8, 0x69u8, 0x6cu8, 0x73u8, 0x20u8, 0x61u8,
        0x62u8, 0x6fu8, 0x75u8, 0x74u8, 0x20u8, 0x74u8, 0x68u8, 0x65u8, 0x73u8, 0x65u8, 0x20u8,
        0x65u8, 0x70u8, 0x68u8, 0x65u8, 0x6du8, 0x65u8, 0x72u8, 0x69u8, 0x73u8, 0x20u8, 0x66u8,
        0x69u8, 0x6cu8, 0x65u8, 0x73u8, 0x20u8, 0x61u8, 0x72u8, 0x65u8, 0x20u8, 0x63u8, 0x6fu8,
        0x6eu8, 0x74u8, 0x61u8, 0x69u8, 0x6eu8, 0x65u8, 0x64u8, 0x20u8, 0x69u8, 0x6eu8, 0x20u8,
        0x61u8, 0x63u8, 0x63u8, 0x6fu8, 0x6du8, 0x70u8, 0x61u8, 0x6eu8, 0x79u8, 0x69u8, 0x6eu8,
        0x67u8, 0x20u8, 0x64u8, 0x6fu8, 0x63u8, 0x75u8, 0x6du8, 0x65u8, 0x6eu8, 0x74u8, 0x61u8,
        0x74u8, 0x69u8, 0x6fu8, 0x6eu8, 0x00u8, 0x61u8, 0x76u8, 0x61u8, 0x69u8, 0x6cu8, 0x61u8,
        0x62u8, 0x6cu8, 0x65u8, 0x20u8, 0x6fu8, 0x6eu8, 0x20u8, 0x74u8, 0x68u8, 0x65u8, 0x20u8,
        0x4eu8, 0x41u8, 0x49u8, 0x46u8, 0x20u8, 0x73u8, 0x65u8, 0x72u8, 0x76u8, 0x65u8, 0x72u8,
        0x3au8, 0x20u8, 0x20u8, 0x68u8, 0x74u8, 0x74u8, 0x70u8, 0x3au8, 0x2fu8, 0x2fu8, 0x6eu8,
        0x61u8, 0x69u8, 0x66u8, 0x2eu8, 0x6au8, 0x70u8, 0x6cu8, 0x2eu8, 0x6eu8, 0x61u8, 0x73u8,
        0x61u8, 0x2eu8, 0x67u8, 0x6fu8, 0x76u8, 0x2fu8, 0x70u8, 0x75u8, 0x62u8, 0x2fu8, 0x6eu8,
        0x61u8, 0x69u8, 0x66u8, 0x2fu8, 0x67u8, 0x65u8, 0x6eu8, 0x65u8, 0x72u8, 0x69u8, 0x63u8,
        0x5fu8, 0x6bu8, 0x65u8, 0x72u8, 0x6eu8, 0x65u8, 0x6cu8, 0x73u8, 0x2fu8, 0x73u8, 0x70u8,
        0x6bu8, 0x2fu8, 0x70u8, 0x6cu8, 0x61u8, 0x6eu8, 0x65u8, 0x74u8, 0x73u8, 0x2fu8, 0x00u8,
        0x00u8, 0x00u8, 0x53u8, 0x70u8, 0x65u8, 0x63u8, 0x69u8, 0x61u8, 0x6cu8, 0x20u8, 0x6eu8,
        0x6fu8, 0x74u8, 0x65u8, 0x20u8, 0x72u8, 0x65u8, 0x67u8, 0x61u8, 0x72u8, 0x64u8, 0x69u8,
        0x6eu8, 0x67u8, 0x20u8, 0x4du8, 0x61u8, 0x72u8, 0x73u8, 0x3au8, 0x20u8, 0x20u8, 0x73u8,
        0x74u8, 0x61u8, 0x72u8, 0x74u8, 0x69u8, 0x6eu8, 0x67u8, 0x20u8, 0x77u8, 0x69u8, 0x74u8,
        0x68u8, 0x20u8, 0x74u8, 0x68u8, 0x69u8, 0x73u8, 0x20u8, 0x44u8, 0x45u8, 0x20u8, 0x66u8,
        0x69u8, 0x6cu8, 0x65u8, 0x20u8, 0x74u8, 0x68u8, 0x65u8, 0x20u8, 0x6cu8, 0x6fu8, 0x63u8,
        0x61u8, 0x74u8, 0x69u8, 0x6fu8, 0x6eu8, 0x20u8, 0x6fu8, 0x66u8, 0x20u8, 0x4du8, 0x61u8,
        0x72u8, 0x73u8, 0x27u8, 0x20u8, 0x6du8, 0x61u8, 0x73u8, 0x73u8, 0x20u8, 0x63u8, 0x65u8,
        0x6eu8, 0x74u8, 0x65u8, 0x72u8, 0x00u8, 0x28u8, 0x4eu8, 0x41u8, 0x49u8, 0x46u8, 0x20u8,
        0x49u8, 0x44u8, 0x20u8, 0x3du8, 0x20u8, 0x34u8, 0x39u8, 0x39u8, 0x29u8, 0x20u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x69u8, 0x73u8, 0x20u8, 0x2au8, 0x4eu8, 0x4fu8, 0x54u8, 0x2au8, 0x20u8, 0x69u8,
        0x6eu8, 0x63u8, 0x6cu8, 0x75u8, 0x64u8, 0x65u8, 0x64u8, 0x3bu8, 0x20u8, 0x6fu8, 0x6eu8,
        0x6cu8, 0x79u8, 0x20u8, 0x74u8, 0x68u8, 0x65u8, 0x20u8, 0x4du8, 0x61u8, 0x72u8, 0x73u8,
        0x20u8, 0x73u8, 0x79u8, 0x73u8, 0x74u8, 0x65u8, 0x6du8, 0x20u8, 0x62u8, 0x61u8, 0x72u8,
        0x79u8, 0x63u8, 0x65u8, 0x6eu8, 0x74u8, 0x65u8, 0x72u8, 0x20u8, 0x28u8, 0x49u8, 0x44u8,
        0x20u8, 0x3du8, 0x20u8, 0x34u8, 0x29u8, 0x20u8, 0x69u8, 0x73u8, 0x20u8, 0x70u8, 0x72u8,
        0x65u8, 0x73u8, 0x65u8, 0x6eu8, 0x74u8, 0x2eu8, 0x00u8, 0x54u8, 0x68u8, 0x65u8, 0x20u8,
        0x6fu8, 0x66u8, 0x66u8, 0x73u8, 0x65u8, 0x74u8, 0x20u8, 0x62u8, 0x65u8, 0x74u8, 0x77u8,
        0x65u8, 0x65u8, 0x6eu8, 0x20u8, 0x4du8, 0x61u8, 0x72u8, 0x73u8, 0x27u8, 0x20u8, 0x6du8,
        0x61u8, 0x73u8, 0x73u8, 0x20u8, 0x63u8, 0x65u8, 0x6eu8, 0x74u8, 0x65u8, 0x72u8, 0x20u8,
        0x61u8, 0x6eu8, 0x64u8, 0x20u8, 0x74u8, 0x68u8, 0x65u8, 0x20u8, 0x4du8, 0x61u8, 0x72u8,
        0x73u8, 0x27u8, 0x20u8, 0x73u8, 0x79u8, 0x73u8, 0x74u8, 0x65u8, 0x6du8, 0x20u8, 0x62u8,
        0x61u8, 0x72u8, 0x79u8, 0x63u8, 0x65u8, 0x6eu8, 0x74u8, 0x65u8, 0x72u8, 0x20u8, 0x69u8,
        0x6eu8, 0x20u8, 0x44u8, 0x45u8, 0x34u8, 0x30u8, 0x33u8, 0x20u8, 0x69u8, 0x73u8, 0x20u8,
        0x71u8, 0x75u8, 0x69u8, 0x74u8, 0x65u8, 0x20u8, 0x73u8, 0x6du8, 0x61u8, 0x6cu8, 0x6cu8,
        0x00u8, 0x2du8, 0x2du8, 0x61u8, 0x62u8, 0x6fu8, 0x75u8, 0x74u8, 0x20u8, 0x32u8, 0x30u8,
        0x20u8, 0x63u8, 0x6du8, 0x2eu8, 0x2du8, 0x2du8, 0x73u8, 0x6fu8, 0x20u8, 0x6du8, 0x6fu8,
        0x73u8, 0x74u8, 0x20u8, 0x53u8, 0x50u8, 0x49u8, 0x43u8, 0x45u8, 0x20u8, 0x75u8, 0x73u8,
        0x65u8, 0x72u8, 0x73u8, 0x20u8, 0x63u8, 0x6fu8, 0x75u8, 0x6cu8, 0x64u8, 0x20u8, 0x75u8,
        0x73u8, 0x65u8, 0x20u8, 0x74u8, 0x68u8, 0x65u8, 0x20u8, 0x4du8, 0x61u8, 0x72u8, 0x73u8,
        0x20u8, 0x73u8, 0x79u8, 0x73u8, 0x74u8, 0x65u8, 0x6du8, 0x20u8, 0x62u8, 0x61u8, 0x72u8,
        0x79u8, 0x63u8, 0x65u8, 0x6eu8, 0x74u8, 0x65u8, 0x72u8, 0x20u8, 0x69u8, 0x6eu8, 0x20u8,
        0x70u8, 0x6cu8, 0x61u8, 0x63u8, 0x65u8, 0x20u8, 0x6fu8, 0x66u8, 0x20u8, 0x74u8, 0x68u8,
        0x65u8, 0x00u8, 0x4du8, 0x61u8, 0x72u8, 0x73u8, 0x20u8, 0x6du8, 0x61u8, 0x73u8, 0x73u8,
        0x20u8, 0x63u8, 0x65u8, 0x6eu8, 0x74u8, 0x65u8, 0x72u8, 0x2eu8, 0x20u8, 0x48u8, 0x6fu8,
        0x77u8, 0x65u8, 0x76u8, 0x65u8, 0x72u8, 0x2cu8, 0x20u8, 0x69u8, 0x66u8, 0x20u8, 0x79u8,
        0x6fu8, 0x75u8, 0x20u8, 0x77u8, 0x69u8, 0x73u8, 0x68u8, 0x2fu8, 0x6eu8, 0x65u8, 0x65u8,
        0x64u8, 0x20u8, 0x74u8, 0x6fu8, 0x20u8, 0x68u8, 0x61u8, 0x76u8, 0x65u8, 0x20u8, 0x74u8,
        0x68u8, 0x65u8, 0x20u8, 0x4du8, 0x61u8, 0x72u8, 0x73u8, 0x20u8, 0x6du8, 0x61u8, 0x73u8,
        0x73u8, 0x20u8, 0x63u8, 0x65u8, 0x6eu8, 0x74u8, 0x65u8, 0x72u8, 0x20u8, 0x61u8, 0x76u8,
        0x61u8, 0x69u8, 0x6cu8, 0x61u8, 0x62u8, 0x6cu8, 0x65u8, 0x20u8, 0x74u8, 0x6fu8, 0x20u8,
        0x79u8, 0x6fu8, 0x75u8, 0x72u8, 0x00u8, 0x70u8, 0x72u8, 0x6fu8, 0x67u8, 0x72u8, 0x61u8,
        0x6du8, 0x2cu8, 0x20u8, 0x79u8, 0x6fu8, 0x75u8, 0x27u8, 0x6cu8, 0x6cu8, 0x20u8, 0x6eu8,
        0x65u8, 0x65u8, 0x64u8, 0x20u8, 0x74u8, 0x6fu8, 0x20u8, 0x6cu8, 0x6fu8, 0x61u8, 0x64u8,
        0x20u8, 0x61u8, 0x20u8, 0x4du8, 0x61u8, 0x72u8, 0x73u8, 0x20u8, 0x73u8, 0x61u8, 0x74u8,
        0x65u8, 0x6cu8, 0x6cu8, 0x69u8, 0x74u8, 0x65u8, 0x20u8, 0x65u8, 0x70u8, 0x68u8, 0x65u8,
        0x6du8, 0x65u8, 0x72u8, 0x69u8, 0x73u8, 0x20u8, 0x66u8, 0x69u8, 0x6cu8, 0x65u8, 0x20u8,
        0x73u8, 0x75u8, 0x63u8, 0x68u8, 0x20u8, 0x61u8, 0x73u8, 0x20u8, 0x22u8, 0x6du8, 0x61u8,
        0x72u8, 0x30u8, 0x39u8, 0x37u8, 0x2eu8, 0x62u8, 0x73u8, 0x70u8, 0x22u8, 0x20u8, 0x69u8,
        0x6eu8, 0x20u8, 0x61u8, 0x64u8, 0x64u8, 0x69u8, 0x74u8, 0x69u8, 0x6fu8, 0x6eu8, 0x00u8,
        0x74u8, 0x6fu8, 0x20u8, 0x44u8, 0x45u8, 0x34u8, 0x33u8, 0x30u8, 0x2eu8, 0x20u8, 0x53u8,
        0x61u8, 0x74u8, 0x65u8, 0x6cu8, 0x6cu8, 0x69u8, 0x74u8, 0x65u8, 0x20u8, 0x65u8, 0x70u8,
        0x68u8, 0x65u8, 0x6du8, 0x65u8, 0x72u8, 0x69u8, 0x73u8, 0x20u8, 0x66u8, 0x69u8, 0x6cu8,
        0x65u8, 0x73u8, 0x20u8, 0x61u8, 0x72u8, 0x65u8, 0x20u8, 0x61u8, 0x76u8, 0x61u8, 0x69u8,
        0x6cu8, 0x61u8, 0x62u8, 0x6cu8, 0x65u8, 0x20u8, 0x66u8, 0x72u8, 0x6fu8, 0x6du8, 0x20u8,
        0x74u8, 0x68u8, 0x65u8, 0x20u8, 0x4eu8, 0x41u8, 0x49u8, 0x46u8, 0x20u8, 0x73u8, 0x65u8,
        0x72u8, 0x76u8, 0x65u8, 0x72u8, 0x20u8, 0x68u8, 0x65u8, 0x72u8, 0x65u8, 0x3au8, 0x00u8,
        0x68u8, 0x74u8, 0x74u8, 0x70u8, 0x3au8, 0x2fu8, 0x2fu8, 0x6eu8, 0x61u8, 0x69u8, 0x66u8,
        0x2eu8, 0x6au8, 0x70u8, 0x6cu8, 0x2eu8, 0x6eu8, 0x61u8, 0x73u8, 0x61u8, 0x2eu8, 0x67u8,
        0x6fu8, 0x76u8, 0x2fu8, 0x70u8, 0x75u8, 0x62u8, 0x2fu8, 0x6eu8, 0x61u8, 0x69u8, 0x66u8,
        0x2fu8, 0x67u8, 0x65u8, 0x6eu8, 0x65u8, 0x72u8, 0x69u8, 0x63u8, 0x5fu8, 0x6bu8, 0x65u8,
        0x72u8, 0x6eu8, 0x65u8, 0x6cu8, 0x73u8, 0x2fu8, 0x73u8, 0x70u8, 0x6bu8, 0x2fu8, 0x73u8,
        0x61u8, 0x74u8, 0x65u8, 0x6cu8, 0x6cu8, 0x69u8, 0x74u8, 0x65u8, 0x73u8, 0x2fu8, 0x00u8,
        0x00u8, 0x00u8, 0x44u8, 0x65u8, 0x74u8, 0x61u8, 0x69u8, 0x6cu8, 0x73u8, 0x20u8, 0x61u8,
        0x62u8, 0x6fu8, 0x75u8, 0x74u8, 0x20u8, 0x53u8, 0x50u8, 0x49u8, 0x43u8, 0x45u8, 0x20u8,
        0x70u8, 0x6cu8, 0x61u8, 0x6eu8, 0x65u8, 0x74u8, 0x20u8, 0x61u8, 0x6eu8, 0x64u8, 0x20u8,
        0x73u8, 0x61u8, 0x74u8, 0x65u8, 0x6cu8, 0x6cu8, 0x69u8, 0x74u8, 0x65u8, 0x20u8, 0x65u8,
        0x70u8, 0x68u8, 0x65u8, 0x6du8, 0x65u8, 0x72u8, 0x69u8, 0x73u8, 0x20u8, 0x66u8, 0x69u8,
        0x6cu8, 0x65u8, 0x73u8, 0x2cu8, 0x20u8, 0x6bu8, 0x6eu8, 0x6fu8, 0x77u8, 0x6eu8, 0x20u8,
        0x61u8, 0x73u8, 0x20u8, 0x53u8, 0x50u8, 0x4bu8, 0x20u8, 0x66u8, 0x69u8, 0x6cu8, 0x65u8,
        0x73u8, 0x2cu8, 0x20u8, 0x69u8, 0x6eu8, 0x63u8, 0x6cu8, 0x75u8, 0x64u8, 0x69u8, 0x6eu8,
        0x67u8, 0x00u8, 0x68u8, 0x6fu8, 0x77u8, 0x20u8, 0x74u8, 0x6fu8, 0x20u8, 0x72u8, 0x65u8,
        0x61u8, 0x64u8, 0x20u8, 0x74u8, 0x68u8, 0x65u8, 0x6du8, 0x20u8, 0x75u8, 0x73u8, 0x69u8,
        0x6eu8, 0x67u8, 0x20u8, 0x53u8, 0x50u8, 0x49u8, 0x43u8, 0x45u8, 0x20u8, 0x54u8, 0x6fu8,
        0x6fu8, 0x6cu8, 0x6bu8, 0x69u8, 0x74u8, 0x20u8, 0x73u8, 0x6fu8, 0x66u8, 0x74u8, 0x77u8,
        0x61u8, 0x72u8, 0x65u8, 0x2cu8, 0x20u8, 0x6du8, 0x61u8, 0x79u8, 0x20u8, 0x62u8, 0x65u8,
        0x20u8, 0x66u8, 0x6fu8, 0x75u8, 0x6eu8, 0x64u8, 0x20u8, 0x69u8, 0x6eu8, 0x20u8, 0x74u8,
        0x68u8, 0x65u8, 0x20u8, 0x53u8, 0x50u8, 0x4bu8, 0x20u8, 0x74u8, 0x75u8, 0x74u8, 0x6fu8,
        0x72u8, 0x69u8, 0x61u8, 0x6cu8, 0x20u8, 0x28u8, 0x50u8, 0x44u8, 0x46u8, 0x20u8, 0x66u8,
        0x69u8, 0x6cu8, 0x65u8, 0x00u8, 0x6eu8, 0x61u8, 0x6du8, 0x65u8, 0x20u8, 0x69u8, 0x73u8,
        0x20u8, 0x22u8, 0x31u8, 0x39u8, 0x5fu8, 0x73u8, 0x70u8, 0x6bu8, 0x22u8, 0x29u8, 0x20u8,
        0x61u8, 0x76u8, 0x61u8, 0x69u8, 0x6cu8, 0x61u8, 0x62u8, 0x6cu8, 0x65u8, 0x20u8, 0x66u8,
        0x72u8, 0x6fu8, 0x6du8, 0x20u8, 0x74u8, 0x68u8, 0x65u8, 0x20u8, 0x4eu8, 0x41u8, 0x49u8,
        0x46u8, 0x20u8, 0x77u8, 0x65u8, 0x62u8, 0x73u8, 0x69u8, 0x74u8, 0x65u8, 0x20u8, 0x28u8,
        0x68u8, 0x74u8, 0x74u8, 0x70u8, 0x3au8, 0x2fu8, 0x2fu8, 0x6eu8, 0x61u8, 0x69u8, 0x66u8,
        0x2eu8, 0x6au8, 0x70u8, 0x6cu8, 0x2eu8, 0x6eu8, 0x61u8, 0x73u8, 0x61u8, 0x2eu8, 0x67u8,
        0x6fu8, 0x76u8, 0x2fu8, 0x74u8, 0x75u8, 0x74u8, 0x6fu8, 0x72u8, 0x69u8, 0x61u8, 0x6cu8,
        0x73u8, 0x2eu8, 0x68u8, 0x74u8, 0x6du8, 0x6cu8, 0x29u8, 0x2eu8, 0x00u8, 0x00u8, 0x00u8,
        0x04u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8,
    ];

    let (unparsed_string, comment) =
        parse_comment_area(&COMMENT_AREA_SEGMENT, 2).expect("Comment area parsing should succeed");

    assert_eq!(unparsed_string.len(), 0);

    assert_eq!(
        r#"September 03, 2013
C. Acton

JPL's Solar System Dynamics Group has released two new planetary/lunar ephemerides,
named DE430 and DE431.

DE430 is now considered the official export lunar/planetary ephemeris, suitable for
all users/uses. It's approximate time span is 1550 JAN 01 to 2650 JAN 22.

If a longer time span is needed, DE431 may be used, except that the lunar ephemeris
portion is of relatively poor accuracy outside of the time span covered by DE430.
The time span covered by DE431 is approximately 13202 B.C. to 17191 A.D. Because de431
is so long, leading to a huge file, it has been split into two parts having the
approximagte time spans of:

    13202 B.C. to     0
        0      to 17191 A.D.

More details about these ephemeris files are contained in accompanying documentation
available on the NAIF server:  http://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/planets/


Special note regarding Mars:  starting with this DE file the location of Mars' mass center
(NAIF ID = 499) is *NOT* included; only the Mars system barycenter (ID = 4) is present.
The offset between Mars' mass center and the Mars' system barycenter in DE403 is quite small
--about 20 cm.--so most SPICE users could use the Mars system barycenter in place of the
Mars mass center. However, if you wish/need to have the Mars mass center available to your
program, you'll need to load a Mars satellite ephemeris file such as "mar097.bsp" in addition
to DE430. Satellite ephemeris files are available from the NAIF server here:
http://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/satellites/


Details about SPICE planet and satellite ephemeris files, known as SPK files, including
how to read them using SPICE Toolkit software, may be found in the SPK tutorial (PDF file
name is "19_spk") available from the NAIF website (http://naif.jpl.nasa.gov/tutorials.html)."#,
        comment
    );
}

#[test]
fn test_parse_file_record() {
    // NASA NAIF spy returns the following values for the file record bytes below
    // ==================================================================
    //  File Architecture      :  DAF
    //  Binary File Format     :  LTL-IEEE
    //  FTP Validation String  :  Present and Intact
    //  Internal File Name     :  NIO2SPK
    //  ID Word                :  DAF/SPK
    //  ND                     :  2
    //  NI                     :  6
    //  Forward Record Pointer :  4
    //  Backward Record Pointer:  4
    //  First Free Address     :  14967465
    // ==================================================================
    const FILE_RECORD_SEGMENT: [u8; 1024] = [
        0x44u8, 0x41u8, 0x46u8, 0x2Fu8, 0x53u8, 0x50u8, 0x4Bu8, 0x20u8, 0x02u8, 0x00u8, 0x00u8,
        0x00u8, 0x06u8, 0x00u8, 0x00u8, 0x00u8, 0x4Eu8, 0x49u8, 0x4Fu8, 0x32u8, 0x53u8, 0x50u8,
        0x4Bu8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8,
        0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x20u8, 0x04u8,
        0x00u8, 0x00u8, 0x00u8, 0x04u8, 0x00u8, 0x00u8, 0x00u8, 0xA9u8, 0x62u8, 0xE4u8, 0x00u8,
        0x4Cu8, 0x54u8, 0x4Cu8, 0x2Du8, 0x49u8, 0x45u8, 0x45u8, 0x45u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x46u8, 0x54u8, 0x50u8, 0x53u8, 0x54u8,
        0x52u8, 0x3Au8, 0x0Du8, 0x3Au8, 0x0Au8, 0x3Au8, 0x0Du8, 0x0Au8, 0x3Au8, 0x0Du8, 0x00u8,
        0x3Au8, 0x81u8, 0x3Au8, 0x10u8, 0xCEu8, 0x3Au8, 0x45u8, 0x4Eu8, 0x44u8, 0x46u8, 0x54u8,
        0x50u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8, 0x00u8,
        0x00u8,
    ];

    let (unparsed_string, file_record) =
        parse_file_record(&FILE_RECORD_SEGMENT).expect("File record parsing should succeed");

    assert_eq!(unparsed_string.len(), 0);

    assert_eq!(file_record.locidw, "DAF/SPK");
    assert_eq!(file_record.nd, 2);
    assert_eq!(file_record.ni, 6);
    assert_eq!(file_record.locifn, "NIO2SPK");
    assert_eq!(file_record.fward, 4);
    assert_eq!(file_record.bward, 4);
    assert_eq!(file_record.free, 14967465);
    assert_eq!(file_record.locfmt, "LTL-IEEE");
    assert_eq!(
        file_record.ftpstr,
        b"FTPSTR:\r:\n:\r\n:\r\x00:\x81:\x10\xce:ENDFTP"
    );
}
